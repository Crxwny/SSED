<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>A7 – JSON Schema Validator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
          sans-serif;
        margin: 0;
        padding: 1.5rem;
        background: #0f172a;
        color: #e2e8f0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
      }
      main {
        width: min(960px, 100%);
        background: #1e293b;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 20px 50px rgba(15, 23, 42, 0.55);
      }
      h1 {
        margin-top: 0;
        font-size: clamp(1.8rem, 2vw, 2.4rem);
      }
      textarea {
        width: 100%;
        min-height: 220px;
        font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
        border-radius: 8px;
        border: 1px solid #475569;
        padding: 1rem;
        background: #0f172a;
        color: #f8fafc;
        resize: vertical;
      }
      button {
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        cursor: pointer;
        background: linear-gradient(120deg, #22d3ee, #3b82f6);
        color: #0f172a;
        font-weight: 600;
        margin: 1rem 0;
      }
      button:focus-visible {
        outline: 3px solid #22d3ee;
      }
      section.validators {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1rem;
      }
      .panel {
        background: #0f172a;
        border-radius: 10px;
        padding: 1rem 1.25rem;
        border: 1px solid #334155;
      }
      .panel h2 {
        margin-top: 0;
      }
      .result {
        font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
        font-size: 0.95rem;
        white-space: pre-wrap;
        word-break: break-word;
      }
      .result[data-state='ok'] {
        color: #22c55e;
      }
      .result[data-state='error'] {
        color: #f97316;
      }
      .help {
        font-size: 0.95rem;
        color: #cbd5f5;
      }
      @media (prefers-color-scheme: light) {
        body {
          background: #f5f5f7;
          color: #0f172a;
        }
        main {
          background: #fff;
        }
        textarea {
          background: #fff;
          color: #0f172a;
        }
        .panel {
          background: #fff;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h1>A7: JSON Schema Validierung</h1>
      <p class="help">
        Die Aufgabe demonstriert zwei Validatoren (Ajv + Joi) anhand desselben
        Schemas. Passe das JSON oder das Schema an, um weitere Tests zu
        ermöglichen.
      </p>

      <label for="jsonInput">Beispiel-JSON:</label>
      <textarea id="jsonInput" spellcheck="false"></textarea>
      <button id="validateBtn" type="button">Validieren</button>

      <section class="validators">
        <article class="panel">
          <h2>Ajv (JSON Schema)</h2>
          <pre class="result" id="ajvResult">Noch nicht geprüft.</pre>
        </article>
        <article class="panel">
          <h2>Joi</h2>
          <pre class="result" id="joiResult">Noch nicht geprüft.</pre>
        </article>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/ajv@8/dist/ajv7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/joi@17/dist/joi-browser.min.js"></script>
    <script>
      const defaultPerson = {
        id: 1,
        firstname: 'Anna',
        lastname: 'Huber',
        email: 'anna.huber@example.com',
        age: 19,
        skills: ['HTML', 'CSS', 'JavaScript'],
      };

      const personSchema = {
        $schema: 'https://json-schema.org/draft/2020-12/schema',
        type: 'object',
        additionalProperties: false,
        required: ['id', 'firstname', 'lastname', 'email', 'age', 'skills'],
        properties: {
          id: { type: 'integer', minimum: 1 },
          firstname: { type: 'string', minLength: 2 },
          lastname: { type: 'string', minLength: 2 },
          email: { type: 'string', format: 'email' },
          age: { type: 'integer', minimum: 0, maximum: 120 },
          skills: {
            type: 'array',
            minItems: 1,
            items: { type: 'string', minLength: 2 },
          },
        },
      };

      const personJoiSchema = Joi.object({
        id: Joi.number().integer().min(1).required(),
        firstname: Joi.string().min(2).required(),
        lastname: Joi.string().min(2).required(),
        email: Joi.string().email({ tlds: false }).required(),
        age: Joi.number().integer().min(0).max(120).required(),
        skills: Joi.array().items(Joi.string().min(2)).min(1).required(),
      }).required();

      const jsonInput = document.getElementById('jsonInput');
      const ajvResult = document.getElementById('ajvResult');
      const joiResult = document.getElementById('joiResult');
      const ajv = new Ajv({ allErrors: true, allowUnionTypes: true });
      const validateAjv = ajv.compile(personSchema);

      jsonInput.value = JSON.stringify(defaultPerson, null, 2);

      const formatAjvErrors = (errors) =>
        errors
          .map(
            (err) =>
              `${err.instancePath || '/'}: ${err.message}${
                err.params?.allowedValues
                  ? ` (${err.params.allowedValues.join(', ')})`
                  : ''
              }`,
          )
          .join('\n');

      const formatJoiErrors = (details) =>
        details.map((detail) => `${detail.path.join('.')}: ${detail.message}`).join('\n');

      document.getElementById('validateBtn').addEventListener('click', () => {
        let parsed;
        try {
          parsed = JSON.parse(jsonInput.value);
        } catch (error) {
          const message = `JSON konnte nicht geparst werden: ${error.message}`;
          ajvResult.textContent = message;
          ajvResult.dataset.state = 'error';
          joiResult.textContent = message;
          joiResult.dataset.state = 'error';
          return;
        }

        if (validateAjv(parsed)) {
          ajvResult.textContent = '✅ Ajv: Objekt erfüllt das Schema.';
          ajvResult.dataset.state = 'ok';
        } else {
          ajvResult.textContent = `❌ Ajv: Schema verletzt.\n${formatAjvErrors(
            validateAjv.errors,
          )}`;
          ajvResult.dataset.state = 'error';
        }

        const joiOutcome = personJoiSchema.validate(parsed, {
          abortEarly: false,
          convert: false,
        });
        if (!joiOutcome.error) {
          joiResult.textContent = '✅ Joi: Objekt erfüllt das Schema.';
          joiResult.dataset.state = 'ok';
        } else {
          joiResult.textContent = `❌ Joi: Schema verletzt.\n${formatJoiErrors(
            joiOutcome.error.details,
          )}`;
          joiResult.dataset.state = 'error';
        }
      });
    </script>
  </body>
</html>

